/*! For license information please see builder-support.js.LICENSE.txt */
System.register(["jimu-core","jimu-for-builder","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-layouts/layout-builder","jimu-ui","jimu-theme","jimu-core/react"],(function(e,t){var o={},a={},n={},i={},r={},l={},s={},c={};return Object.defineProperty(c,"__esModule",{value:!0}),{setters:[function(e){o.AppMode=e.AppMode,o.AppType=e.AppType,o.BrowserSizeMode=e.BrowserSizeMode,o.ContainerType=e.ContainerType,o.ErrorBoundary=e.ErrorBoundary,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.WidgetManager=e.WidgetManager,o.WidgetState=e.WidgetState,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.appConfigUtils=e.appConfigUtils,o.classNames=e.classNames,o.css=e.css,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished,o.useIntl=e.useIntl},function(e){a.LayoutServiceProvider=e.LayoutServiceProvider,a.appBuilderSync=e.appBuilderSync,a.getAppConfigAction=e.getAppConfigAction,a.placeholderService=e.placeholderService,a.utils=e.utils,a.widgetService=e.widgetService},function(e){n.LayoutContext=e.LayoutContext,n.PageContext=e.PageContext,n.searchUtils=e.searchUtils,n.utils=e.utils},function(e){i.WidgetListPopper=e.WidgetListPopper},function(e){r.CanvasPane=e.CanvasPane,r.DropArea=e.DropArea,r.addItemToLayout=e.addItemToLayout,r.withRnd=e.withRnd},function(e){l.Button=e.Button,l.FloatingPanel=e.FloatingPanel,l.Icon=e.Icon,l.Loading=e.Loading,l.MobilePanel=e.MobilePanel,l.NavButtonGroup=e.NavButtonGroup,l.Popper=e.Popper,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages,l.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,l.utils=e.utils},function(e){s.getBuilderThemeVariables=e.getBuilderThemeVariables,s.styled=e.styled},function(e){Object.keys(e).forEach((function(t){c[t]=e[t]}))}],execute:function(){e((()=>{var e={9859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},2838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},7154:(e,t,o)=>{"use strict";var a=o(8972);var n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=a.useSyncExternalStore,r=a.useRef,l=a.useEffect,s=a.useMemo,c=a.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,o,a,d){var u=r(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=s((function(){function e(e){if(!l){if(l=!0,i=e,e=a(e),void 0!==d&&p.hasValue){var t=p.value;if(d(t,e))return r=t}return r=e}if(t=r,n(i,e))return t;var o=a(e);return void 0!==d&&d(t,o)?t:(i=e,r=o)}var i,r,l=!1,s=void 0===o?null:o;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]}),[t,o,a,d]);var g=i(e,u[0],u[1]);return l((function(){p.hasValue=!0,p.value=g}),[g]),c(g),g}},8418:(e,t,o)=>{"use strict";e.exports=o(7154)},9244:e=>{"use strict";e.exports=o},8972:e=>{"use strict";e.exports=c},4108:e=>{"use strict";e.exports=a},6055:e=>{"use strict";e.exports=r},1496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=s},4321:e=>{"use strict";e.exports=l},9298:e=>{"use strict";e.exports=i}},t={};function d(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var o in t)d.o(t,o)&&!d.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";d.r(u),d.d(u,{default:()=>Pe});var e=d(9244);const t="controller",o={sm:24,default:32,lg:48},a={width:150,height:120},n={width:300,height:300},i={x:70,y:70},r={x:30,y:30};var l;!function(e){e.TopLeft="TOP_LEFT",e.TopRight="TOP_RIGHT",e.BottomLeft="BOTTOM_LEFT",e.BottomRight="BOTTOM_RIGHT",e.TopCenter="TOP_CENTER",e.BottomCenter="BOTTOM_CENTER",e.MiddleLeft="MIDDLE_LEFT",e.MiddleRight="MIDDLE_RIGHT",e.MiddleCenter="MIDDLE_CENTER"}(l||(l={}));l.TopRight;const s=[{name:"preventOverflow",options:{boundary:document.body,rootBoundary:document}},{name:"offset",options:{offset:[0,16]}}];var c=d(4108),p=d(1496);const g=(t,o)=>{const a=e.ReactRedux.useSelector((e=>e.widgetsRuntimeInfo)),n=v(t,o),i=h(n);return e.React.useMemo((()=>{const t={};return i.forEach((o=>{var n;const i=null!==(n=null==a?void 0:a[o])&&void 0!==n?n:{isClassLoaded:!1};t[o]=(0,e.Immutable)(i)})),(0,e.Immutable)(t)}),[i,a])},v=(t,o)=>e.ReactRedux.useSelector((e=>{var a,n,i,r;const l=null===(i=null===(n=null===(a=e.appConfig.widgets)||void 0===a?void 0:a[t])||void 0===n?void 0:n.layouts)||void 0===i?void 0:i[o],s=e.browserSizeMode,c=e.appConfig.mainSizeMode,d=p.searchUtils.findLayoutId(l,s,c);return null===(r=e.appConfig.layouts)||void 0===r?void 0:r[d]})),f=(t,o)=>{var a,n,i,r;const l=(0,e.getAppStore)().getState().appConfig,s=(0,e.getAppStore)().getState().browserSizeMode,c=null===(i=null===(n=null===(a=l.widgets)||void 0===a?void 0:a[t])||void 0===n?void 0:n.layouts)||void 0===i?void 0:i[o],d=p.searchUtils.findLayoutId(c,s,l.mainSizeMode);return null===(r=l.layouts)||void 0===r?void 0:r[d]},m=e=>{var t,o,a;let n=(null!==(a=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==a?a:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return n=n.filter((e=>e&&e.id&&e.widgetId&&!e.isPending)),n.map((e=>e.id))},h=e=>m(e).map((t=>{var o,a;return null===(a=null===(o=e.content)||void 0===o?void 0:o[t])||void 0===a?void 0:a.widgetId})),y=(e,t)=>{if(null!=(null==e?void 0:e.content)&&t)return Object.keys(e.content).find((o=>e.content[o].widgetId===t))},b=t=>[e.WidgetState.Opened,e.WidgetState.Active].includes(t.state);var w=d(9298),S=d(6055),I=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,l)}s((a=a.apply(e,t||[])).next())}))};const R=t=>{var o;let a=!0;const n=null==t?void 0:t.itemType,i=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.name;if((n===e.LayoutItemType.Section||["controller"].includes(i))&&(a=!1),p.utils.isWidgetPlaceholder(p.utils.getAppConfig(),t)){a=!1;const o=(0,e.getAppStore)().getState(),n=o.appInfo.type===e.AppType.Template,i=c.placeholderService.getPlaceholderInfo(o.appConfig,t.layoutInfo);n&&i&&o.browserSizeMode!==o.appConfig.mainSizeMode&&(a=!0)}return a},x=(t,o,a)=>{const n={layoutId:t.id};let i=(0,c.getAppConfigAction)();(0,S.addItemToLayout)(i.appConfig,o,t.id).then((t=>{i=(0,c.getAppConfigAction)(t.updatedAppConfig),i.adjustOrderOfItem(t.layoutInfo,a||0),i.editLayoutItemProperty(t.layoutInfo,"bbox",{}),(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(i.appConfig,n))}))},C=(t,o,a)=>I(void 0,void 0,void 0,(function*(){if(0===t.length)return;let n=(0,c.getAppConfigAction)();const i=t[0].id,{updatedAppConfig:r,layoutInfo:l}=yield(0,S.addItemToLayout)(n.appConfig,o,i);n=(0,c.getAppConfigAction)(r),n.adjustOrderOfItem(l,a||0),n.editLayoutItemProperty(l,"bbox",{});const s=t.slice(1).map((e=>e.id)),d=p.searchUtils.findLayoutItem(n.appConfig,l);s.forEach((t=>{var o,a,i;const{updatedAppConfig:r,layoutItemId:l}=((t,o,a)=>{const n=c.LayoutServiceProvider.getService(t,o).createBlankItem(t,o);let i=n[0];const r=n[1],l={layoutId:o,layoutItemId:r},s=p.searchUtils.findLayoutItem(i,l).set("widgetId",a).set("type",e.LayoutItemType.Widget);i=i.setIn(["layouts",o,"content",r],s);const d=e.appConfigUtils.getSizeModeOfALayout(i,o);return i=c.widgetService.addParent(i,a,l,d),i=c.widgetService.afterAdded(i,a,o,d,d),{updatedAppConfig:i,layoutItemId:r}})(n.appConfig,t,d.widgetId),s=null!==(i=null===(a=(null===(o=r.layouts)||void 0===o?void 0:o[t]).order)||void 0===a?void 0:a.length)&&void 0!==i?i:0;n=(0,c.getAppConfigAction)(r);const u={layoutId:t,layoutItemId:l};n.adjustOrderOfItem(u,s||0),n.editLayoutItemProperty(u,"bbox",{})})),(0,e.getAppStore)().dispatch(e.appActions.appConfigChanged(n.appConfig))}));var O=d(4321),j=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};const A=(e,t,a)=>{let n=o[e];t&&(n+=21);return n+=2*k(e,a),n},k=(e,t)=>"circle"===t?"sm"===e||"default"===e||"lg"===e?0:void 0:0,P={none:"0",sm:"0",default:"var(--sys-shape-1)",lg:"var(--sys-shape-2)"},E=e.React.forwardRef(((t,o)=>{var a;const{label:n,className:i,title:r,showLabel:l,showIndicator:s=!0,showTooltip:c=!0,labelGrowth:d=0,icon:u,marker:p,onClick:g,onMarkerClick:v,avatar:f,autoFlip:m,active:h,editDraggable:y,disabled:b,widgetid:w}=t,S=j(t,["label","className","title","showLabel","showIndicator","showTooltip","labelGrowth","icon","marker","onClick","onMarkerClick","avatar","autoFlip","active","editDraggable","disabled","widgetid"]),I=f||{},{shape:R,style:x}=I,C=j(I,["shape","style"]),E=(null==C?void 0:C.size)||"default",M=((t,o,a,n,i)=>e.React.useMemo((()=>{A(t,o,n);const i=k(t,n);return e.css`
      display: flex;
      align-items:center;
      flex-direction: column;
      justify-content: ${o?"space-around":"center"};
      width: 5rem !important;
      height: 5rem !important;
      .tool-drag-handler {
        cursor: auto;
      }
      .avatar {
        padding: ${i}px;
        position: relative;
        text-align: center;
        &:hover .marker {
          visibility: visible;
        }
        .marker {
          position: absolute;
          right: 0;
          top: 0;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          .icon-btn-sizer {
            min-width: 3rem !important;
            min-height: 3rem !important;
          }
          visibility: hidden;
        }
      }
      ${a?".avatar.active {\n        .avatar-button, .marker {\n          transform: translateY(-7px);\n        }\n        .marker {\n          z-index: 1;\n        }\n        ::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          border: 1px solid var(--ref-palette-white);\n          border-radius: 3px;\n          width: 6px;\n          height: 3px;\n          background-color: var(--sys-color-primary-main);\n          box-sizing: content-box;\n        }\n      }":""}
      .avatar-label {
        text-align: center;
        width: 100%;
        min-height: ${e.polished.rem(10)};
        cursor: default;
      }
    `}),[t,o,n,i,a]))(E,l,s,R,d),z=P[E],T=(0,e.jsx)(O.Button,Object.assign({"data-widgetid":w,icon:!0,active:h,className:(0,e.classNames)("avatar-button",{disabled:b}),ref:o},C,{style:Object.assign({borderRadius:"circle"===R?"50%":z},x),onClick:g}),(0,e.jsx)(O.Icon,{style:{width:"24px",height:"24px"},color:"string"!=typeof u&&(null===(a=u.properties)||void 0===a?void 0:a.color),icon:"string"!=typeof u?u.svg:u,autoFlip:m}));return(0,e.jsx)("div",Object.assign({},S,{className:(0,e.classNames)("avatar-card",`${i} avatar-card`),css:M}),(0,e.jsx)("div",{className:(0,e.classNames)({"no-drag-action":!y,active:h},"avatar tool-drag-handler")},p&&(0,e.jsx)(O.Button,{className:"marker",size:"lg",icon:!0,onClick:v},(0,e.jsx)(O.Icon,{size:8,icon:p})),c?(0,e.jsx)(O.Tooltip,{title:r||n,style:{pointerEvents:"none"}},T):T),l&&(0,e.jsx)("div",{className:(0,e.classNames)("avatar-label text-truncate",{active:h})},n))}));var M=d(2838),z=d.n(M);const T=(t,o,a=0,n=a,i)=>{let r=((t,o=500,a=!1,n)=>{var i,r;const l=a?"clientHeight":"clientWidth",[s,c]=e.React.useState(null!==(r=null===(i=t.current)||void 0===i?void 0:i[l])&&void 0!==r?r:0),d=!n&&!window.jimuConfig.isInBuilder,u=e.hooks.useLatest((()=>{const e=t.current[l]||0;c(e)})),p=e.React.useMemo((()=>e.lodash.debounce((()=>{u.current()}),o,{leading:!0})),[]);return e.React.useEffect((()=>{if(d)return;const e=t.current;e&&p();const o=new ResizeObserver(p);return o.observe(e),()=>{o.disconnect(),p.cancel()}}),[t,p,d]),s})(t,500,o,!i);r+=a,r=Math.max(r,n);const l=((t=500,o=!1)=>{const a=o?"clientHeight":"clientWidth",[n,i]=e.React.useState((()=>document.body[a]-40));e.hooks.useUpdateEffect((()=>{i(document.body[a]-40)}),[a]);const r=e.React.useMemo((()=>e.lodash.debounce((()=>{i(document.body[a]-40)}),t)),[a,t]);return e.React.useEffect((()=>(window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)})),[r]),n})(500,o);return r=i?l:Math.min(r,l),r},L=(e,t,o)=>{let a=e,n=t;return n-a>o?n=e+o:n-a<o&&(a=0,n=a+o),[a,n]};var N=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};const W=[],B=e.React.forwardRef(((t,o)=>{const{scrollRef:a,className:n,lists:i=W,createItem:r,vertical:l,itemLength:s,space:c,onChange:d,autoHideArrow:u,minLength:p=s,autoScrollEnd:g,autoSize:v,onScrollStatusChange:f}=t,m=N(t,["scrollRef","className","lists","createItem","vertical","itemLength","space","onChange","autoHideArrow","minLength","autoScrollEnd","autoSize","onScrollStatusChange"]),h=e.hooks.useTranslation(O.defaultMessages),[y,b]=e.hooks.useForwardRef(o),{start:w,end:S,disablePrevious:I,disableNext:R,hideArrow:x,scroll:C}=(t=>{var o;const{rootRef:a,lists:n,itemLength:i,autoSize:r,vertical:l,space:s,minLength:c,autoScrollEnd:d}=t,u=null!==(o=null==n?void 0:n.length)&&void 0!==o?o:0,p=T(a,l,s,c,r),g=Math.floor(p/i)>u?u:Math.floor(p/i),[v,f]=e.React.useState(L(0,0,g)[0]),[m,h]=e.React.useState(L(0,0,g)[1]),y=e.hooks.useLatest(v),b=e.hooks.useLatest(m),w=m-v>=u,S=0===v,I=m===u;e.React.useEffect((()=>{if(0===p)return;const[e,t]=L(b.current,y.current,g);f(e),h(t)}),[g,p,b,y]);const R=e.hooks.useEventCallback(((e,t=!0)=>{const o=t?1:g;let a=0,n=0;e?(a=v-o,a<0?(a=0,n=a+g):n=m-o):(n=m+o,n>u?(n=u,a=n-g):a=v+o),f(a),h(n)})),x=e.React.useRef([]),C=e.hooks.useEventCallback((()=>{const e=u>0&&x.current.length>0&&n[n.length-1]!==x.current[x.current.length-1];if(d&&e&&x.current.length>u){let e=0,t=0;t=u,e=t-g,e=Math.max(0,e),f(e),h(t)}}));return e.React.useEffect((()=>{C(),x.current=n}),[n,C]),{start:v,end:m,disablePrevious:S,disableNext:I,hideArrow:w,scroll:R}})({rootRef:y,lists:i,itemLength:s,autoSize:v,vertical:l,space:c,minLength:p,autoScrollEnd:g}),j=i.slice(w,S),A=((t,o,a,n,i)=>e.css`
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    button.previous, button.next {
      flex-shrink: 0;
      display: ${i?"none":"block"};
    }
    .root {
      flex-direction: ${t?"column":"row"};
      width: 100%;
      height: 100%;
      ${t?`min-height: ${a}px;`:`min-width: ${a}px;`} 
      max-height: ${n?"100%":"calc(100% - 20px)"};
      max-width: ${n?"100%":"calc(100% - 20px)"};
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      .scroll-list-item {
        &:not(:first-of-type) {
          margin-top: ${t?o+"px":"unset"};
          margin-left: ${t?"unset":o+"px"};
        }
      }
    }
`)(l,c,p,v,x);e.React.useEffect((()=>{null==f||f(x,I,R)}),[R,I,x,f]),e.React.useEffect((()=>{O.utils.setRef(a,C)}),[C,a]);return(0,e.jsx)(O.NavButtonGroup,Object.assign({},m,{css:A,type:"tertiary",vertical:l,onChange:e=>{null==d||d(e),C(e,!0)},disablePrevious:I,disableNext:R,previousAriaLabel:h("previous"),nextAriaLabel:h("next"),className:(0,e.classNames)("scroll-list",n)}),(0,e.jsx)("div",{className:"root scroll-list-root",ref:b},i.map((t=>{const o=!j.includes(t);return r(t,(0,e.classNames)("scroll-list-item",{"d-none":o}))}))))}));var D=d(9859),$=d.n(D),H=d(1888);const F=(0,H.styled)("div",{shouldForwardProp:e=>!["vertical","space"].includes(e)})`
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: ${e=>e.vertical?"column":"row"};
  .avatar-placeholder {
    &:not(:first-of-type) {
      margin-top: ${t=>t.vertical?e.polished.rem(t.space):"unset"};
      margin-left: ${t=>t.vertical?"unset":e.polished.rem(t.space)};
    }
  }
`,_=(e=>{const t=[];for(;e>0;)t.push(e),e--;return t})(3),G={type:"secondary",size:"lg",shape:"circle"},U=t=>{const{vertical:o,space:a,size:n="lg"}=t,i=e.React.useMemo((()=>Object.assign(Object.assign({},G),{size:n})),[n]);return e.React.createElement(F,{className:"list-placeholder",vertical:o,space:a},_.map(((t,o)=>e.React.createElement(E,{key:o,disabled:!0,className:"avatar-placeholder",icon:$(),label:"",showTooltip:!1,avatar:i}))))};var V=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};const Y=e.React.forwardRef(((t,o)=>{const{widgetId:a,layout:n,layouts:i,vertical:r,childClass:l,placeholder:s,className:c}=t,d=V(t,["widgetId","layout","layouts","vertical","childClass","placeholder","className"]),{color:u,size:[g,v]}=s,f=e.React.useRef(null),m=e.React.useRef(null),h=e.React.useRef(null),y=e.React.useRef(null),b=e.React.useRef(null),[w,I]=e.React.useState(!1),R=e.hooks.useForkRef(f,o),C=e.css`
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    bottom: 0;
    top: 0;
    right: 0;
    background: transparent;
    z-index: ${w?1:0};
    > .drop-area {
      width: 100%;
      height: 100%;
    }
    > .overlay {
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      background: transparent;
      z-index: -1;
      &.hide {
        display: none;
      }
    }
  `;e.React.useEffect((()=>{m.current=new S.CanvasPane(b.current)}),[]);return(0,e.jsx)("div",Object.assign({className:(0,e.classNames)("drop-zone",c),ref:R},d,{css:C}),(0,e.jsx)(S.DropArea,{style:C,className:"drop-area",layouts:i,highlightDragover:!0,onDragOver:(e,t,o,a,n,i)=>{let l=a;const s=y.current,c=f.current.offsetHeight,d=f.current.offsetWidth;if(s&&s.length)if(r){const{insertY:e,refId:t}=((e,t,o)=>{let a,n,i=!1;if(t.some(((e,r)=>{if(e.top+e.height/2>o){if(0===r)a=e.top;else{const o=t[r-1];a=(e.top+o.top+o.height)/2}i=!0,n=e.id}return i})),!i){const e=t[t.length-1];a=e.top+e.height}return{insertY:a,refId:n}})(0,s,i);h.current=t,l={top:e-v/2+f.current.scrollTop,width:g,left:(d-g)/2+f.current.scrollLeft,height:v}}else{const{insertX:e,refId:t}=((e,t,o)=>{let a,n,i=!1;if(t.some(((e,r)=>{if(e.left+e.width/2>o){if(0===r)a=e.left;else{const o=t[r-1];a=(e.left+o.left+o.width)/2}i=!0,n=e.id}return i})),!i){const e=t[t.length-1];a=e.left+e.width}return{insertX:a,refId:n}})(0,s,n);h.current=t,l={left:e-v/2+f.current.scrollLeft,width:v,top:(c-g)/2+f.current.scrollTop,height:g}}else l=r?{top:o.height/2-v/2,width:g,left:(d-g)/2+f.current.scrollLeft,height:v}:{left:o.width/2-v/2,width:v,top:(c-g)/2+f.current.scrollTop,height:g};m.current.clear(),m.current.setColor(u),m.current.drawRect(l)},onDrop:(t,o,a)=>{var i,r,l;m.current.clear();let s=0;h.current?s=n.order&&n.order.indexOf(h.current)||0:n.order&&(s=n.order.length),x(n,t,s);const c=(0,e.getAppStore)().getState().appConfig.layouts,{layoutId:d,layoutItemId:u}=t.layoutInfo||{},p=null===(l=null===(r=null===(i=c[d])||void 0===i?void 0:i.content)||void 0===r?void 0:r[u])||void 0===l?void 0:l.widgetId;p&&(0,e.getAppStore)().dispatch(e.appActions.closeWidget(p)),h.current=null,y.current=[]},onToggleDragoverEffect:e=>{e&&(h.current=null,(()=>{y.current=[];const e=f.current.getBoundingClientRect(),t=f.current.parentNode.querySelectorAll(`.${l}`);t&&t.length&&t.forEach((t=>{const o=t.getAttribute("data-layoutitemid");if(n.order&&n.order.includes(o)){const a=p.utils.relativeClientRect(t.getBoundingClientRect(),e);a.id=o,y.current.push(a)}})),r?y.current.sort(((e,t)=>e.top-t.top)):y.current.sort(((e,t)=>e.left-t.left))})(),m.current.setSize(f.current.clientWidth,f.current.clientHeight)),I(e)}}),(0,e.jsx)("canvas",{className:(0,e.classNames)("overlay",{hide:!w}),ref:b}))})),q=(0,S.withRnd)(!1)((t=>{var o,a;const{className:n,layoutId:i,layoutItemId:r,markerEnabled:l,showLabel:s,showTooltip:d,labelGrowth:u,avatar:p,editDraggable:g}=t,v=(0,e.getAppStore)().getState(),f=c.placeholderService.getPlaceholderInfo(v.appConfig,{layoutId:i,layoutItemId:r}),m=c.utils.getPlaceholderItemForWidgetsList((0,e.useIntl)()),h=v.appInfo.type===e.AppType.Template,y=v.appRuntimeInfo.appMode===e.AppMode.Design;return f&&e.React.createElement(E,{className:(0,e.classNames)("placeholder-avatar-card",n),label:m.label+" "+f.id,icon:m.icon,autoFlip:null===(a=null===(o=null==m?void 0:m.manifest)||void 0===o?void 0:o.properties)||void 0===a?void 0:a.flipIcon,marker:l&&h&&y?z():"",showLabel:s,showTooltip:d,labelGrowth:u,avatar:p,editDraggable:g&&h&&y,onMarkerClick:()=>{c.appBuilderSync.publishConfirmDeleteToApp({layoutId:i,layoutItemId:r})}})})),X=(0,S.withRnd)(!1)((t=>{var o,a;const{markerEnabled:n,onMarkerClick:i,widgetid:r,showLabel:l,showIndicator:s,showTooltip:c,labelGrowth:d,avatar:u,onClick:p,active:g,editDraggable:v,className:f}=t,m=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets)||void 0===t?void 0:t[r]}));return m?e.React.createElement(E,{"data-widgetid":r,widgetid:r,className:`widget-avatar-card ${f}`,showLabel:l,showIndicator:s,showTooltip:c,labelGrowth:d,avatar:u,label:m.label,icon:m.icon,autoFlip:null===(a=null===(o=null==m?void 0:m.manifest)||void 0===o?void 0:o.properties)||void 0===a?void 0:a.flipIcon,marker:n?z():"",active:g,editDraggable:v,onMarkerClick:i,onClick:p}):e.React.createElement(O.Loading,null)})),Z=t=>{const{className:o,draggable:a,layoutId:n,layoutItem:i,onClick:r,label:l,showLabel:s,showIndicator:c,showTooltip:d,labelGrowth:u,markerEnabled:p,avatar:g,active:v,removeWidget:f}=t;return i.widgetId?e.React.createElement(X,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:n,layoutItem:i,widgetid:i.widgetId,layoutItemId:i.id,label:l,markerEnabled:p,showLabel:s,showIndicator:c,showTooltip:d,labelGrowth:u,avatar:g,active:v,editDraggable:a,useDragHandler:!0,onClick:r,onMarkerClick:()=>{f(i.widgetId)}}):e.React.createElement(q,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:n,layoutItem:i,layoutItemId:i.id,markerEnabled:p,showLabel:s,showTooltip:d,labelGrowth:u,avatar:g,editDraggable:a,useDragHandler:!0})};var K=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};const J=e.React.forwardRef(((o,a)=>{const{widgetId:n,draggable:i,itemStyle:r,vertical:l,className:s,space:d,dropZoneRef:u,onItemClick:f,onClick:h,scrollRef:y,markerEnabled:w=!0,autoSize:S,placeholder:I,afterRemoveWidget:x}=o,C=K(o,["widgetId","draggable","itemStyle","vertical","className","space","dropZoneRef","onItemClick","onClick","scrollRef","markerEnabled","autoSize","placeholder","afterRemoveWidget"]),O=e.ReactRedux.useSelector((e=>{var o,a,i;return null===(i=null===(a=null===(o=e.appConfig.widgets)||void 0===o?void 0:o[n])||void 0===a?void 0:a.layouts)||void 0===i?void 0:i[t]})),j=v(n,t),k=c.placeholderService.isSupported()?(e=>{var t,o,a;let n=(null!==(a=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==a?a:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return n=n.filter((e=>e&&e.id&&!e.isPending)),n.map((e=>e.id))})(j):m(j),P=(0,H.getBuilderThemeVariables)(),E=g(n,t),M=Object.keys(E).filter((e=>b(E[e]))),z=((e,t)=>{const o=null==e?void 0:e.showLabel,a=null==e?void 0:e.labelGrowth,n=null==e?void 0:e.avatar.size,i=null==e?void 0:e.avatar.shape;return A(n,o,i)+t+a})(r,d),T={color:null==P?void 0:P.sys.color.primary.light,size:[z,5]};return j&&e.React.createElement(p.LayoutContext.Provider,{value:{isItemAccepted:R}},e.React.createElement("div",{ref:a,className:(0,e.classNames)(s,"layout controller-layout w-100 h-100 d-flex align-items-center justify-content-center"),"data-layoutid":j.id,onClick:h},e.React.createElement(Y,{widgetId:n,vertical:l,layout:j,childClass:`layout-${j.id}-item`,placeholder:T,layouts:O}),I||e.React.createElement(B,Object.assign({},C,{autoSize:S,scrollRef:y,className:"layout-item-list",vertical:l,itemLength:z,space:d,autoHideArrow:!0,lists:k,autoScrollEnd:!0,createItem:(t,o)=>{const a=j.content[t],n=a&&a.widgetId||"",l=M.includes(n);return e.React.createElement(Z,Object.assign({},r,{key:t,className:(0,e.classNames)(`layout-${null==j?void 0:j.id}-item layout-item`,o),widgetid:n,layoutId:j.id,layoutItemId:t,draggable:i,markerEnabled:w,layoutItem:a,active:l,removeWidget:e=>{var o;o={layoutId:j.id,layoutItemId:t},c.appBuilderSync.publishConfirmDeleteToApp(o),x(e)},onClick:f}))}}))))}));var Q=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};const ee=e.React.forwardRef(((t,o)=>{var a;const{showPlaceholder:n,itemStyle:i,space:r,vertical:l}=t,s=Q(t,["showPlaceholder","itemStyle","space","vertical"]),c=l?r:i.labelGrowth;return e.React.createElement(J,Object.assign({className:"w-100 h-100",ref:o,itemStyle:i,space:r,vertical:l,placeholder:n?e.React.createElement(U,{size:null===(a=i.avatar)||void 0===a?void 0:a.size,space:c,vertical:l}):void 0},s))}));var te=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o};function oe(t){const{widgetId:o,canCrossLayoutBoundary:a,className:n,layoutId:i,layoutItemId:r}=t,l=te(t,["widgetId","canCrossLayoutBoundary","className","layoutId","layoutItemId"]),s=e.hooks.useCancelablePromiseMaker(),[c,d]=e.React.useState(null),[u,p]=e.React.useState(""),[g,v]=e.React.useState("");e.React.useEffect((()=>{d(null),p("");const t=s((t=>{var o,a;if(!t)return;return(null===(a=null===(o=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===o?void 0:o[t])||void 0===a?void 0:a.isClassLoaded)?Promise.resolve(e.WidgetManager.getInstance().getWidgetClass(t)):e.WidgetManager.getInstance().loadWidgetClass(t)})(o));t.then((e=>{d(e),p(o)}),(e=>{var t;v(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e)}))}),[s,o]);const f=e.React.useCallback((()=>{var t,a;if(g)return;if(window.jimuConfig.isBuilder)return;(null===(a=null===(t=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===t?void 0:t[o])||void 0===a?void 0:a.state)===e.WidgetState.Active||(0,e.getAppStore)().dispatch(e.appActions.activateWidget(o))}),[g,o]),m=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Design)),h=e.ReactRedux.useSelector((e=>{var t,a,n;const i=e.appConfig.widgets[o];return null!==(n=null===(a=null===(t=null==i?void 0:i.manifest)||void 0===t?void 0:t.properties)||void 0===a?void 0:a.supportInlineEditing)&&void 0!==n&&n})),y=e.ReactRedux.useSelector((e=>{const t=e.widgetsRuntimeInfo[o];return h&&(null==t?void 0:t.isInlineEditing)})),b=e.ReactRedux.useSelector((t=>{var a;const n=t.appConfig.widgets[o];return(null===(a=null==n?void 0:n.manifest)||void 0===a?void 0:a.widgetType)!==e.WidgetType.Layout})),w=e.ReactRedux.useSelector((e=>{var t,a,n;const i=e.appConfig.widgets[o];return(null===(a=null===(t=null==i?void 0:i.manifest)||void 0===t?void 0:t.properties)||void 0===a?void 0:a.hasEmbeddedLayout)&&Object.keys(null!==(n=i.layouts)&&void 0!==n?n:{}).length>0})),S=m&&!y&&b&&!w,I=e.React.useCallback((t=>{h&&(t.stopPropagation(),(0,e.getAppStore)().dispatch(e.appActions.setWidgetIsInlineEditingState(o,!0)))}),[o,h]),R=(0,e.classNames)("widget-renderer w-100 h-100",n),x=(t=>e.React.useMemo((()=>e.css`
      overflow: ${t?"visible":"hidden"};
      position: relative;
      .widget-content {
        position: relative;
        height: 100%;
        width: 100%;
        z-index: 0;
      }
      .widget-mask {
        position: absolute;
        background: transparent;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 1;
      }
  `),[t]))(a);return(0,e.jsx)("div",Object.assign({css:x,className:R,onMouseDownCapture:f,onDoubleClickCapture:I,"data-widgetid":u},l),(0,e.jsx)("div",{className:"widget-content p-1"},g,!g&&c&&(0,e.jsx)(e.ErrorBoundary,null,(0,e.jsx)(c,{widgetId:u,layoutId:i,layoutItemId:r})),!g&&!c&&(0,e.jsx)(O.Loading,null)),S&&(0,e.jsx)("div",{className:"widget-mask"}))}const ae=(0,e.Immutable)({}),ne=o=>{var a,n,i;const{controllerId:r,containerMapId:l,onClose:s,widgets:c=ae}=o,d=null!==(a=Object.keys(c).find((e=>b(c[e]))))&&void 0!==a?a:"",u=null===(i=null===(n=(0,e.getAppStore)().getState().appConfig.widgets)||void 0===n?void 0:n[d])||void 0===i?void 0:i.label,p=v(r,t),g=e.React.useCallback(((t,o)=>{var a;t.stopPropagation();const n=null==p?void 0:p.id,i=y(p,o),r=null===(a=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===a?void 0:a.selection;r&&r.layoutId===n&&r.layoutItemId===i||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:i}))}),[p]);return e.React.createElement(O.MobilePanel,{className:(0,e.classNames)("mobile-widget-launcher",{"d-none":!d}),mapWidgetId:l,title:u,open:!!d,keepMount:!0,onClick:e=>{g(e,d)},onClose:e=>{null==e||e.stopPropagation(),null==e||e.nativeEvent.stopImmediatePropagation(),null==s||s(d)}},Object.entries(c).map((([t,o])=>{if(!(void 0!==o.state))return null;const a=b(o),n=null==p?void 0:p.id,i=y(p,t);return e.React.createElement(oe,{key:t,widgetId:t,layoutId:n,layoutItemId:i,onClick:e=>{g(e,t)},className:(0,e.classNames)({"d-none":!a})})})))};var ie;!function(e){e.Stack="STACK",e.SideBySide="SIDEBYSIDE"}(ie||(ie={}));const re={_widgetLabel:"Widget Controller",_action_openWidget_label:"Open widget",resizerTooltip:"Customize the window size by dragging and dropping."},le=e=>document.querySelector(`.widget-controller .avatar-card[data-widgetid='${e}']`),se=()=>{const t=`url("data:image/svg+xml;base64,${window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">\n    <g clip-path="url(#rectangle)">\n      <path d="M10 2.77832V0L0 10H2.77832L10 2.77832Z" fill="#000000" />\n      <path d="M10 5.60674L5.60675 10H10V5.60674Z" fill="#000000" />\n    </g>\n    <defs>\n      <clipPath id="rectangle">\n        <rect width="10" height="10" fill="white" />\n      </clipPath>\n    </defs>\n  </svg>')}")`;return e.css`
    .resizer {
      bottom: 4px !important;
      right: 4px !important;
      background-color: var(--sys-color-secondary-dark);
      mask-image: ${t};
      border: none !important;
    }
  `},ce=()=>e.css`
    .resizer {
      width: 9px !important;
      height: 9px !important;
      position: absolute;
      bottom: 4px !important;
      right: 4px !important;
      border: 1px solid #000 !important;
      background: #fff;
      clip-path: polygon(5px 0px, 9px 0px, 9px 9px, 0px 9px, 0px 5px, 5px 5px);
      &::before {
        content: '';
        position: absolute;
        width: 5px;
        height: 5px;
        border-right: 1px solid #000;
        border-bottom: 1px solid #000;
      }
    }
  `,de=()=>{const t=e.hooks.useTranslation(re),o=e.React.useMemo((()=>e.css`
    position: absolute;
    width: 15px;
    height: 15px;
    bottom: 0;
    right: 0;
  `),[]);return e.React.useMemo((()=>(0,e.jsx)(O.Tooltip,{title:t("resizerTooltip")},(0,e.jsx)("div",{className:"resizer-tooltip",css:o}))),[o,t])},ue=(o,a)=>{const n=f(a,t),i=Object.keys(n.content).find((e=>n.content[e].widgetId===o));(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n.id,layoutItemId:i}))},pe=()=>document.body.getBoundingClientRect(),ge=(t,o,a,n,i)=>{const[r,l]=e.React.useState((()=>pe())),[s,c]=e.React.useState([a]),d=e.React.useRef(0);e.React.useEffect((()=>{const e=()=>{const e=pe();l(e)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const u=(e,t)=>e.right>=t.right||e.left<=t.left,p=(e,t)=>e.bottom>=t.bottom||e.top<=t.top,g=e.hooks.useEventCallback((e=>{if(d.current++,d.current>7)return console.warn(`Number of cycles: ${d.current}.You may have opened too many panels, and now there is not enough space for them to be placed without overstepping and blocking`),e;const o=((e,t)=>!(!e||!t)&&(u(e,t)||p(e,t)))(e,r);if(!o)return e;const{width:n,height:l}=e;let{left:s,top:c,right:v,bottom:f}=e;if(o){const e=u({left:s,top:c,right:v,bottom:f,width:n,height:l},r),o=p({left:s,top:c,right:v,bottom:f,width:n,height:l},r);e&&(s=t===ie.SideBySide?a.x:r.right-n),o||t!==ie.SideBySide||(c+=i),v=s+n,f=c+l}return g({left:s,top:c,right:v,bottom:f,width:n,height:l})}));return e.React.useEffect((()=>{const e=[];let r={width:0,height:0};Object.keys(o).forEach(((l,s)=>{const c=o[l],u=0!==s?e[s-1]:a;let{x:p,y:v}=u;if(t===ie.SideBySide){const{width:e}=r;p+=n>0?e:-e,p+=0!==s?n:0}else t===ie.Stack&&(p+=0!==s?n:0,v+=0!==s?i:0);const f={left:p,top:v,right:p+c.width,bottom:v+c.height,width:c.width,height:c.height},{left:m,top:h}=g(f);d.current>7?(p=u.x,v=u.y):(p=m,v=h),d.current=0,e.push({x:p,y:v}),r=c})),c(e)}),[t,a,n,i,r.width,r.height,g,o]),s},ve=(0,e.Immutable)({}),fe=o=>{const{mode:a,start:i,spaceX:r,spaceY:l,sizes:s,controllerId:c,widgets:d=ve,onResizeStop:u,onClose:p}=o,g=e.ReactRedux.useSelector((e=>e.appConfig.widgets)),[f,m]=e.React.useState(s),h=e.React.useMemo((()=>((t,o)=>{let a=(0,e.Immutable)({});return Object.keys(t).forEach((e=>{a=a.set(e,o[e]||n)})),a})(d,f)),[f,d]),w=v(c,t),S=e.React.useCallback(((t,o)=>{var a;t.stopPropagation();const n=null==w?void 0:w.id,i=y(w,o),r=null===(a=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===a?void 0:a.selection;r&&r.layoutId===n&&r.layoutItemId===i||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:i}))}),[w]),I=e=>{const t=le(e),o=null==t?void 0:t.querySelector("button");null==o||o.focus()},[R,x]=e.React.useState(!1),C=ge(a,h,i,r,l),j=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Run)),A=j?se():ce();return(0,e.jsx)(e.React.Fragment,null,Object.entries(d).map((([t,o],a)=>{var n;if(!(void 0!==o.state))return null;const i=b(o),r=C[a];if(!r)return null;const l=h[t],s=null===(n=null==g?void 0:g[t])||void 0===n?void 0:n.label,c=null==w?void 0:w.id,d=y(w,t);return(0,e.jsx)(O.FloatingPanel,{key:t,css:A,style:{maxWidth:"100vw"},headerTitle:s,defaultPosition:r,defaultSize:l,className:(0,e.classNames)({"d-none":!i},"multiple-widget-launcher"),showHeaderClose:!0,showHeaderCollapse:!0,activateOnlyForHeader:!0,autoFocus:i,dragBounds:"body",onClick:e=>{S(e,t)},onResize:e=>{((e,t)=>{m(f.set(e,t)),x(!0)})(t,e)},onResizeStop:e=>{((e,t)=>{null==u||u(e,t),x(!1)})(t,e)},onLeave:()=>{I(t)},onHeaderClose:e=>{((e,t)=>{null==t||t.stopPropagation(),null==p||p(e),I(e)})(t,e)}},(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(oe,{widgetId:t,layoutId:c,layoutItemId:d}),!R&&!j&&(0,e.jsx)(de,null)))})))},me=(0,e.Immutable)({}),he=o=>{const{controllerId:i,widgets:r=me,root:l,placement:c,sizes:d,onResizeStop:u,onClose:p}=o,g=e.ReactRedux.useSelector((e=>e.appConfig.widgets)),f=v(i,t),m=e.React.useCallback(((t,o)=>{var a;t.stopPropagation();const n=null==f?void 0:f.id,i=y(f,o),r=null===(a=(0,e.getAppStore)().getState().appRuntimeInfo)||void 0===a?void 0:a.selection;r&&r.layoutId===n&&r.layoutItemId===i||(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:n,layoutItemId:i}))}),[f]),[h,b]=e.React.useState(d),[w,S]=e.React.useState(!1),I=(e,t)=>{var o;t.stopPropagation(),null==p||p(e);const a=null===(o=le(e))||void 0===o?void 0:o.querySelector("button");null==a||a.focus()},R=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Run)),x=R?se():ce();return(0,e.jsx)(e.React.Fragment,null,Object.entries(r).map((([t,o])=>{var i,r;if(!(void 0!==o.state))return null;const d=o.state!==e.WidgetState.Closed,p=null!==(i=h[t])&&void 0!==i?i:n,v=null===(r=null==g?void 0:g[t])||void 0===r?void 0:r.label;let C=le(t);C&&C.offsetParent||(C=null==l?void 0:l.querySelector(".avatar-card"));const j=null==f?void 0:f.id,A=y(f,t);return(0,e.jsx)(O.Popper,{key:t,css:x,style:{maxWidth:"100vw"},modifiers:s,className:(0,e.classNames)({"d-none":!d},"single-widget-launcher"),headerTitle:v,activateOnlyForHeader:!0,minSize:a,dragBounds:"body",defaultSize:p,onResize:e=>{var o,a;o=t,a=e,b((e=>e.set(o,a))),S(!0)},onResizeStop:e=>{var o,a;o=t,a=e,null==u||u(o,a),S(!1)},onHeaderClose:e=>{I(t,e)},showHeaderCollapse:!0,floating:!0,open:!0,autoFocus:d,reference:C,toggle:e=>{((e,t)=>{"Escape"===(null==t?void 0:t.key)&&I(e,t)})(t,e)},onClick:e=>{m(e,t)},placement:c},(0,e.jsx)(oe,{widgetId:t,layoutId:j,layoutItemId:A}),!w&&!R&&(0,e.jsx)(de,null))})))},ye=t=>{const o=(0,e.getAppStore)().getState().appConfig.sections,a=Object.values(null!=o?o:{}).find((e=>{var o;return null===(o=e.views)||void 0===o?void 0:o.includes(t)}));return null==a?void 0:a.id},be=(t,o)=>{const a=(t=>{const o=(0,e.getAppStore)().getState().appConfig.sections,a=t?Object.values(t).map((e=>e.currentViewId)):[],n=a.map(ye),i=Object.values(null!=o?o:{}).map((e=>{var t;if(!n.includes(e.id))return null===(t=e.views)||void 0===t?void 0:t[0]})).filter((e=>!!e)),r=a;return i.forEach((e=>{a.includes(e)||r.push(e)})),r})(t),n=(0,e.getAppStore)().getState().browserSizeMode,i=(0,e.getAppStore)().getState().appConfig,r=p.searchUtils.getContentContainerInfo(i,o,e.LayoutItemType.Widget,n);let l=!0;if(!r)return l;if(r.type===e.ContainerType.View)if(a.includes(r.id)){const t=r.id,o=ye(t),s=p.searchUtils.getContentContainerInfo(i,o,e.LayoutItemType.Section,n);s&&s.type===e.ContainerType.View&&(a.includes(s.id)||(l=!1))}else l=!1;return l};function we(o){var a,l,s,c,d,u,v,f,m,h;const{id:y,config:w,version:S,rootRef:I,onResizeStop:R}=o,x=e.hooks.useCheckSmallBrowserSizeMode(),C=null===(a=w.behavior)||void 0===a?void 0:a.onlyOpenOne,O=null!==(s=null===(l=null==w?void 0:w.behavior)||void 0===l?void 0:l.arrangement)&&void 0!==s?s:"floating",j=C&&"floating"===O,A=!C&&"floating"===O,k=e.React.useCallback((t=>{if(!t)return;(0,e.getAppStore)().dispatch(e.appActions.closeWidget(t));const o=le(t);null==o||o.focus(),(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(null))}),[]),P=(t=>e.ReactRedux.useSelector((e=>{var o,a,n,i;const r=e.appConfig,l=e.browserSizeMode,s=r.widgets[t].parent;let c=null!==(o=s[l])&&void 0!==o?o:[];0===c.length&&(c=null!==(a=s[r.mainSizeMode])&&void 0!==a?a:[]);const d=null===(n=c[0])||void 0===n?void 0:n.layoutId,u=p.searchUtils.getWidgetIdThatUseTheLayoutId(r,d),g=r.widgets[u];return"arcgis-map"===(null===(i=null==g?void 0:g.manifest)||void 0===i?void 0:i.name)?g.id:""})))(y),E=(null===(c=w.behavior)||void 0===c?void 0:c.vertical)?"right-start":"bottom",M=null===(d=w.behavior)||void 0===d?void 0:d.displayType,z=null===(f=null===(v=null===(u=(0,e.getAppStore)())||void 0===u?void 0:u.getState())||void 0===v?void 0:v.appContext)||void 0===f?void 0:f.isRTL,T=e.React.useMemo((()=>z?Object.assign(Object.assign({},i),{x:document.body.clientWidth-n.width-i.x}):i),[z]),L=e.React.useMemo((()=>z?Object.assign(Object.assign({},r),{x:-r.x}):r),[z]),N=null===(m=w.behavior)||void 0===m?void 0:m.size,W=g(y,t),B=Object.keys(W),D=B.filter((e=>b(W[e]))),$=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.currentPageId));e.hooks.useUpdateEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.resetWidgetsState(B))}),[S,$]);const H=(t=>{const o=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.sectionNavInfos}));return be(o,t)})(y),F=e.ReactRedux.useSelector((e=>e.appContext.isInBuilder)),_=null===(h=w.behavior)||void 0===h?void 0:h.openStarts;return e.hooks.useUpdateEffect((()=>{H?!F&&(null==_?void 0:_.length)>0&&setTimeout((()=>{(0,e.getAppStore)().dispatch(e.appActions.openWidgets(_,y))}),1e3):(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(D))}),[H]),e.React.useEffect((()=>{F&&(0,e.getAppStore)().dispatch(e.appActions.resetWidgetsState(B)),!F&&(null==_?void 0:_.length)&&H&&setTimeout((()=>{(0,e.getAppStore)().dispatch(e.appActions.openWidgets(_,y))}),1e3)}),[]),(0,e.jsx)(e.React.Fragment,null,x&&(0,e.jsx)(ne,{containerMapId:P,controllerId:y,widgets:W,onClose:k}),!x&&j&&(0,e.jsx)(he,{sizes:N,root:I.current,placement:E,controllerId:y,widgets:W,onResizeStop:R,onClose:k}),!x&&A&&(0,e.jsx)(fe,{sizes:N,mode:M,start:T,spaceX:L.x,spaceY:L.y,controllerId:y,widgets:W,onResizeStop:R,onClose:k}))}var Se=d(8972),Ie=d(8418),Re="default"in Se?Se.default:Se;Symbol.for("react-redux-context"),"undefined"!=typeof globalThis&&globalThis;Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen"),Symbol.for("react.client.reference");!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?Re.useLayoutEffect:Re.useEffect;function xe(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function Ce(e,t){if(xe(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const o=Object.keys(e),a=Object.keys(t);if(o.length!==a.length)return!1;for(let a=0;a<o.length;a++)if(!Object.prototype.hasOwnProperty.call(t,o[a])||!xe(e[o[a]],t[o[a]]))return!1;return!0}Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var Oe;function je(o){const{id:a}=o,{layoutId:n,layoutItem:i}=e.ReactRedux.useSelector((e=>{var o;const n=null===(o=e.appRuntimeInfo)||void 0===o?void 0:o.selection,i=f(a,t);let r,l;return n&&n.layoutId===i.id&&i.content[n.layoutItemId]&&(r=n.layoutId,l=i.content[n.layoutItemId]),{layoutId:r,layoutItem:l}}),Ce),[r,l]=e.React.useState(null);e.React.useEffect((()=>{if(n&&i){let e=0;const t=setInterval((()=>{e++;const o=document.querySelector(`.single-widget-launcher:has(.widget-renderer[data-widgetid=${null==i?void 0:i.widgetId}])`)||document.querySelector(`.multiple-widget-launcher:has(.widget-renderer[data-widgetid=${null==i?void 0:i.widgetId}])`)||document.querySelector(`.mobile-panel-popper:has(.widget-renderer[data-widgetid=${null==i?void 0:i.widgetId}])`);l(o),(e>=20||o)&&clearInterval(t)}),100)}else l(null)}),[n,i]);e.React.useMemo((()=>[{name:"preventOverflow",enabled:!0,options:{boundary:"viewport",altAxis:!0}},{name:"flip",enabled:!0,options:{boundary:"body",fallbackPlacements:(0,O.getFallbackPlacementsModifier)(["top-start","bottom-start"],!0).options.fallbackPlacements}}]),[]),e.hooks.useTranslation();return n&&i&&r&&(0,e.jsx)(e.React.Fragment,null)}Oe=Ie.useSyncExternalStoreWithSelector,(e=>{e})(Se.useSyncExternalStore);var Ae=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function r(e){try{s(a.next(e))}catch(e){i(e)}}function l(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,l)}s((a=a.apply(e,t||[])).next())}))};const ke=e.css`
  width: 300px;
  height: 300px;
  overflow-y: auto;
`,Pe={Builder:o=>{var a,n,i,r;const{id:l,config:s,version:d,autoSize:u}=o,m=e.hooks.useCheckSmallBrowserSizeMode(),h=null!==(n=null===(a=null==s?void 0:s.behavior)||void 0===a?void 0:a.arrangement)&&void 0!==n?n:"floating",{viewOnly:y}=e.React.useContext(p.PageContext),S=e.React.useRef(null),I=e.ReactRedux.useSelector((e=>e.widgetsState[l])),O=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentDialogId})),j=null==I?void 0:I.showWidgetsPanel,A=e.ReactRedux.useSelector((e=>e.browserSizeMode)),k=e.React.useRef(),P=g(l,t),E=((t,o)=>{const a=v(t,o),n=(0,e.getAppStore)().getState().appConfig;return Object.values((null==a?void 0:a.content)||{}).filter((e=>!e.widgetId)).map((e=>c.placeholderService.getPlaceholderInfo(n,{layoutId:a.id,layoutItemId:e.id})))})(l,t),M=!Object.keys(null!=P?P:{}).length&&0===E.length,z="floating"===h||m;e.React.useEffect((()=>{A===e.BrowserSizeMode.Small&&void 0!==j&&c.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!1,isItemAccepted:R,onSelect:D,keepPanel:!0,active:j})}),[j]);const T=e.React.useCallback(((t,o,a)=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(l,"hideArrow",t)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(l,"disablePrevious",o)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(l,"disableNext",a))}),[l]);e.React.useEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(l,"onArrowClick",k.current))}),[l]);const L=e.React.useCallback((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(l,"showWidgetsPanel",!1))}),[l]);e.React.useEffect((()=>{O&&L()}),[L,O]);const N=e.React.useRef([0,0]),W=Object.keys(P).filter((e=>b(P[e]))),B=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Express)),D=e.React.useCallback((o=>Ae(void 0,void 0,void 0,(function*(){var a,n;const i=f(l,t),r=null!==(n=null===(a=i.order)||void 0===a?void 0:a.length)&&void 0!==n?n:0;try{if(B){const{widgets:a,layouts:n}=(0,e.getAppStore)().getState().appConfig,i=Object.values(a[l].layouts[t]).map((e=>n[e]));C(i,o,r)}else x(i,o,r)}catch(e){console.error("Failed to add widget")}}))),[l,B]);return(0,e.jsx)("div",{className:"controller-builder w-100 h-100",ref:S,onClick:e=>{const t=e.target,o=S.current;t&&o&&o.contains(t)&&L()}},z&&(0,e.jsx)(we,{id:l,config:s,version:d,rootRef:S,onResizeStop:(t,o)=>{if(!t)return;let a=(null==s?void 0:s.behavior.size)||(0,e.Immutable)({});a=a.set(t,o);const n=s.setIn(["behavior","size"],a);(0,c.getAppConfigAction)().editWidgetConfig(l,n).exec()}}),(0,e.jsx)(je,{id:l}),(0,e.jsx)(ee,{autoSize:u,scrollRef:k,showPlaceholder:M,onScrollStatusChange:T,vertical:null===(i=null==s?void 0:s.behavior)||void 0===i?void 0:i.vertical,widgetId:l,onItemClick:t=>{var o,a;if(y)return;const n=null===(o=t.currentTarget.dataset)||void 0===o?void 0:o.widgetid,i=N.current[0]!==t.clientX||N.current[1]!==t.clientY;if(!n||i)return;W.includes(n)||t.stopPropagation();const r=null===(a=s.behavior)||void 0===a?void 0:a.onlyOpenOne;((t,o,a,n)=>{n?((0,e.getAppStore)().dispatch(e.appActions.closeWidgets(a)),a.includes(o)||((0,e.getAppStore)().dispatch(e.appActions.openWidget(o,t)),ue(o,t))):a.includes(o)?(0,e.getAppStore)().dispatch(e.appActions.closeWidget(o)):((0,e.getAppStore)().dispatch(e.appActions.openWidget(o,t)),ue(o,t))})(l,n,W,!!m||r)},onMouseDown:e=>{N.current=[e.clientX,e.clientY]},itemStyle:s.appearance.card,draggable:!0,markerEnabled:!y,space:null===(r=null==s?void 0:s.appearance)||void 0===r?void 0:r.space,afterRemoveWidget:e=>{s.behavior.openStarts.includes(e)&&(e=>{(0,c.getAppConfigAction)().editWidgetConfig(l,e).exec()})(s.setIn(["behavior","openStarts"],s.behavior.openStarts.filter((t=>t!==e))))}}),j&&A!==e.BrowserSizeMode.Small&&(0,e.jsx)(w.WidgetListPopper,{css:ke,placement:"right-start",referenceElement:S.current,isAccepted:R,onSelect:D,onClose:e=>{(e=>{var t,o;if(!e)return!1;if("controller-add-widget"===(null===(t=e.dataset)||void 0===t?void 0:t.extname))return!0;const a=e.parentElement;return"controller-add-widget"===(null===(o=null==a?void 0:a.dataset)||void 0===o?void 0:o.extname)})(null==e?void 0:e.target)||L()}}))}}})(),u})())}}}));